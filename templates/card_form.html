{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">{{ 'Edit' if card else 'Add' }} Card</h2>
<form method="post">
  <div class="mb-3">
    <label class="form-label">Name</label>
    <input id="name-input" class="form-control" name="name" list="name-options" value="{{ card[1] if card else '' }}" required>
    <datalist id="name-options"></datalist>
  </div>
  <div class="mb-3">
    <label class="form-label">Language</label>
    <input class="form-control" name="language" value="{{ card[3] if card else '' }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Condition</label>
    <input class="form-control" name="condition" value="{{ card[4] if card else '' }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Price</label>
    <input type="number" step="0.01" class="form-control" name="price" value="{{ card[5] if card else '' }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Storage Code (optional)</label>
    <input class="form-control" name="storage_code" value="{{ card[6] if card else '' }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Cardmarket ID</label>
    <input class="form-control" name="cardmarket_id" value="{{ card[7] if card else '' }}">
  </div>
  {% if folders is not none %}
  <div class="mb-3">
    <label class="form-label">Folder (Set)</label>
    <select name="folder_id" class="form-select">
      <option value="">-- none --</option>
      {% for f in folders %}
      <option value="{{ f[0] }}" {% if card and card[8]==f[0] %}selected{% endif %}>{{ f[1] }}</option>
      {% endfor %}
    </select>
  </div>
  {% endif %}
  <button type="submit" class="btn btn-primary">Save</button>
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const nameInput = document.getElementById('name-input');
  const dataList = document.getElementById('name-options');
  let timeout = null;

  nameInput.addEventListener('input', function() {
    clearTimeout(timeout);
    const query = this.value.trim();
    if (query.length < 2) {
      dataList.innerHTML = '';
      return;
    }
    timeout = setTimeout(function() {
      fetch(`/api/autocomplete?q=${encodeURIComponent(query)}`)
        .then(resp => resp.json())
        .then(data => {
          dataList.innerHTML = '';
          data.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            dataList.appendChild(option);
          });
        });
    }, 300);
  });
});
</script>
{% endblock %}
